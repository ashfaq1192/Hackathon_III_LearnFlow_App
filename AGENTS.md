# LearnFlow Application - Agent Guidelines

## Repository Overview

**LearnFlow** is an AI-powered Python learning platform that uses event-driven microservices architecture. This application is built **entirely by AI agents** (Claude Code and Goose) using skills from the skills-library repository.

**Repository Type**: Application (built with skills)
**Primary Language**: Python (FastAPI backend), TypeScript (Next.js frontend)
**Architecture**: Cloud-native microservices on Kubernetes

---

## Quick Start for AI Agents

### What This Repository Contains

```
learnflow-app/
â”œâ”€â”€ .claude/skills/          # Reusable skills (copied from skills-library)
â”œâ”€â”€ src/services/            # Microservices (generated by fastapi-dapr-agent)
â”‚   â”œâ”€â”€ triage-service/      # Analyzes learner struggles
â”‚   â”œâ”€â”€ concepts-service/    # Explains programming concepts
â”‚   â”œâ”€â”€ exercise-service/    # Manages coding exercises
â”‚   â””â”€â”€ code-execution-service/  # Executes Python code safely
â”œâ”€â”€ src/frontend/            # Next.js app with Monaco Editor
â”œâ”€â”€ k8s/                     # Kubernetes manifests
â”œâ”€â”€ docs/                    # Docusaurus documentation
â””â”€â”€ .specify/                # Development guidelines

Status: ğŸ”¨ Under construction (being built by AI agents)
```

### How to Build This Application

**Use the skills in `.claude/skills/` directory to build autonomously:**

1. **Infrastructure Setup** (use these skills):
   - `k8s-foundation` - Verify Kubernetes cluster
   - `neon-postgres-setup` - Deploy PostgreSQL database
   - `kafka-k8s-setup` - Deploy Kafka for event streaming
   - `dapr-setup` - Install Dapr service mesh

2. **Service Generation** (use this skill):
   - `fastapi-dapr-agent` - Generate all 4 microservices

3. **Frontend Deployment** (use these skills):
   - `nextjs-k8s-deploy` - Deploy Next.js frontend
   - `better-auth-setup` - Configure authentication

4. **API Gateway** (use this skill):
   - `kong-gateway-setup` - Deploy and configure Kong

5. **Documentation** (use this skill):
   - `docusaurus-deploy` - Generate and deploy docs

---

## Architecture

### System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Kong API Gateway                        â”‚
â”‚  (JWT Auth, Rate Limiting, CORS)                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚              â”‚              â”‚              â”‚              â”‚
       â–¼              â–¼              â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Triage   â”‚   â”‚ Concepts â”‚   â”‚ Exercise â”‚   â”‚   Code   â”‚   â”‚ Frontend â”‚
â”‚ Service  â”‚   â”‚ Service  â”‚   â”‚ Service  â”‚   â”‚ Executionâ”‚   â”‚(Next.js) â”‚
â”‚ (AI)     â”‚   â”‚ (AI)     â”‚   â”‚ (CRUD)   â”‚   â”‚ Service  â”‚   â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚              â”‚              â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚         Dapr Sidecars            â”‚
     â”‚  (State, Pub/Sub, Invocation)   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                   â”‚
          â–¼                   â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Neon   â”‚         â”‚  Kafka  â”‚
     â”‚PostgreSQLâ”‚        â”‚(Events) â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Service Responsibilities

| Service | Purpose | Type | AI Integration |
|---------|---------|------|----------------|
| **triage-service** | Analyzes learner struggles and patterns | AI Agent | OpenAI GPT-4 |
| **concepts-service** | Explains Python concepts on-demand | AI Agent | OpenAI GPT-4 |
| **exercise-service** | CRUD operations for exercises | CRUD API | None |
| **code-execution-service** | Safely executes Python code | Executor | None |
| **frontend** | User interface with Monaco Editor | Next.js | None |

---

## Tech Stack

### Required Technologies (Non-Negotiable)

- **Frontend**: Next.js 14+ with Monaco Editor
- **Authentication**: Better Auth (JWT-based)
- **Backend**: FastAPI + Python 3.9+
- **AI**: OpenAI SDK (GPT-4)
- **Service Mesh**: Dapr
- **Messaging**: Apache Kafka
- **Database**: Neon PostgreSQL (serverless)
- **API Gateway**: Kong Gateway
- **Container Orchestration**: Kubernetes
- **Documentation**: Docusaurus

### Why These Technologies?

- **Neon PostgreSQL**: Serverless, auto-scaling, branching capabilities
- **Dapr**: Service mesh abstracts state, pub/sub, invocation
- **Kafka**: Event streaming for learning analytics
- **Kong**: API gateway with JWT, rate limiting, CORS
- **Better Auth**: Modern Next.js authentication
- **Monaco Editor**: VS Code editor in browser

---

## Development Workflow

### Building the Application

**Step 1: Setup Infrastructure**

```bash
# Use skills to deploy infrastructure
claude "Setup LearnFlow infrastructure:
1. Verify Kubernetes cluster (k8s-foundation)
2. Deploy Neon PostgreSQL (neon-postgres-setup)
3. Deploy Kafka (kafka-k8s-setup)
4. Install Dapr (dapr-setup)"
```

**Step 2: Generate Services**

```bash
# Generate all microservices
claude "Generate LearnFlow microservices:
1. Triage service (AI agent type)
2. Concepts service (AI agent type)
3. Exercise service (CRUD API type)
4. Code execution service (code executor type)"
```

**Step 3: Deploy Frontend**

```bash
# Deploy Next.js frontend
claude "Deploy LearnFlow frontend:
1. Generate Next.js app with Monaco Editor
2. Setup Better Auth
3. Deploy to Kubernetes"
```

**Step 4: Configure Gateway**

```bash
# Setup API Gateway
claude "Configure Kong Gateway:
1. Register all services
2. Enable JWT authentication
3. Setup rate limiting"
```

### File Organization

**Where agents should create files:**

- **Microservices**: `src/services/<service-name>/`
- **Frontend**: `src/frontend/`
- **Kubernetes manifests**: `k8s/`
- **Documentation**: `docs/`
- **Configuration**: Root directory (e.g., `docker-compose.yml`)

**Example microservice structure:**
```
src/services/triage-service/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py              # FastAPI app
â”‚   â”œâ”€â”€ models/              # Pydantic models
â”‚   â”‚   â””â”€â”€ schemas.py
â”‚   â”œâ”€â”€ services/            # Business logic
â”‚   â”‚   â”œâ”€â”€ ai_service.py    # OpenAI integration
â”‚   â”‚   â””â”€â”€ dapr_service.py  # Dapr operations
â”‚   â””â”€â”€ dapr/                # Event handlers
â”‚       â””â”€â”€ events.py
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_main.py
â”‚   â””â”€â”€ test_ai_service.py
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ requirements.txt
â””â”€â”€ k8s/
    â”œâ”€â”€ deployment.yaml      # With Dapr annotations
    â””â”€â”€ service.yaml
```

---

## Environment Variables

### Required for All Services

```bash
# Dapr Configuration
DAPR_HTTP_PORT=3500
DAPR_GRPC_PORT=50001

# Database (from Neon PostgreSQL)
DATABASE_URL=postgresql://user:pass@host/db

# Kafka (from Kafka deployment)
KAFKA_BROKERS=kafka.kafka.svc.cluster.local:9092
```

### AI Services Only

```bash
# OpenAI API
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4
OPENAI_MAX_TOKENS=500
```

### Frontend Only

```bash
# Next.js
NEXT_PUBLIC_API_URL=http://kong-gateway.default.svc.cluster.local
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Better Auth
AUTH_SECRET=<generated-secret>
DATABASE_URL=<neon-connection-string>
```

---

## Kubernetes Configuration

### Namespace Strategy

- **Default namespace**: Infrastructure (PostgreSQL, Kafka, Dapr control plane)
- **learnflow namespace**: Application services
- **kong namespace**: API Gateway

### Dapr Annotations (For All Services)

Every service deployment must include:

```yaml
metadata:
  annotations:
    dapr.io/enabled: "true"
    dapr.io/app-id: "<service-name>"
    dapr.io/app-port: "8000"
    dapr.io/log-level: "info"
```

### Resource Limits

**Microservices:**
```yaml
resources:
  requests:
    memory: "256Mi"
    cpu: "100m"
  limits:
    memory: "512Mi"
    cpu: "500m"
```

**AI Services (higher for OpenAI SDK):**
```yaml
resources:
  requests:
    memory: "512Mi"
    cpu: "200m"
  limits:
    memory: "1Gi"
    cpu: "1000m"
```

---

## Testing Strategy

### Unit Tests

Each service should have:
- `tests/test_main.py` - FastAPI endpoint tests
- `tests/test_<service>.py` - Business logic tests

**Run tests:**
```bash
cd src/services/<service-name>
pytest tests/
```

### Integration Tests

Test with Dapr sidecar:
```bash
dapr run --app-id test-service --app-port 8000 -- pytest tests/
```

### End-to-End Tests

Critical user flows to test:
1. User signs up â†’ Better Auth creates account
2. User opens exercise â†’ Monaco Editor loads
3. User submits code â†’ Code execution service runs it
4. User asks for help â†’ Triage service analyzes struggle
5. User requests explanation â†’ Concepts service explains

---

## Common Agent Tasks

### Task: "Add a new microservice"

**Agent should:**
1. Ask clarifying questions (service purpose, type, AI needed?)
2. Use `fastapi-dapr-agent` skill to generate service
3. Configure Dapr components in namespace
4. Register service with Kong Gateway
5. Update this AGENTS.md with service info

### Task: "Deploy to production"

**Agent should:**
1. Verify all services have health checks
2. Check resource limits configured
3. Ensure secrets not committed
4. Deploy in order: DB â†’ Kafka â†’ Dapr â†’ Services â†’ Frontend â†’ Gateway
5. Validate each component before proceeding

### Task: "Add authentication to an endpoint"

**Agent should:**
1. Verify Better Auth configured
2. Add JWT validation middleware
3. Update Kong Gateway routes
4. Test with valid/invalid tokens

### Task: "Debug service not receiving events"

**Agent should:**
1. Check Dapr pub/sub component exists in namespace
2. Verify subscription endpoint (`/dapr/subscribe`)
3. Check Kafka topic exists and has messages
4. Review Dapr sidecar logs

---

## Conventions

### Code Style

**Python:**
- Use `black` formatter
- Type hints everywhere: `def func(x: int) -> str:`
- Async for I/O: `async def get_data():`
- Pydantic for validation

**TypeScript:**
- Use `prettier` formatter
- Strict mode enabled
- Server components by default

### Naming

- **Services**: `<purpose>-service` (e.g., `triage-service`)
- **Routes**: `/health`, `/process`, `/events` (lowercase, no verbs in CRUD)
- **Environment variables**: `SCREAMING_SNAKE_CASE`
- **Functions**: `snake_case` (Python), `camelCase` (TypeScript)

### Git Commits

**Format:**
```
<type>: <description>

Claude: <what skill was used>

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

**Types:** feat, fix, docs, refactor, test, chore

**Example:**
```
feat: add triage service with AI analysis

Claude: Generated using fastapi-dapr-agent skill
- Created FastAPI app with OpenAI integration
- Configured Dapr state management
- Added pub/sub event handlers

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

---

## Troubleshooting for Agents

### Issue: Service not starting

**Check:**
1. Environment variables set?
2. Dependencies installed? (`pip install -r requirements.txt`)
3. Port 8000 available?
4. Logs: `kubectl logs <pod-name>`

### Issue: Dapr sidecar not attached

**Check:**
1. Dapr installed? `dapr status -k`
2. Annotations present in deployment.yaml?
3. Namespace has Dapr components?
4. Sidecar injector running? `kubectl get pods -n dapr-system`

### Issue: Can't connect to database

**Check:**
1. `DATABASE_URL` environment variable set?
2. Secret exists? `kubectl get secret postgres-credentials`
3. Network policy allows connection?
4. Test connection: `psql $DATABASE_URL -c '\l'`

### Issue: Events not being received

**Check:**
1. Kafka running? `kubectl get pods -n kafka`
2. Topic exists? `kubectl exec -it kafka-0 -- kafka-topics.sh --list`
3. Pub/sub component configured?
4. Subscription endpoint returns correct format?

---

## Security Guidelines for Agents

### âœ… DO:
- Store secrets in Kubernetes Secrets
- Use environment variables for configuration
- Validate all user inputs with Pydantic
- Enable JWT authentication via Kong
- Use resource limits on all pods
- Enable network policies

### âŒ DON'T:
- Commit `.env` files
- Hardcode API keys in code
- Expose internal services publicly
- Skip input validation
- Run containers as root
- Disable security features

---

## Deployment Checklist

Before considering LearnFlow complete:

- [ ] All 4 microservices generated and deployed
- [ ] Next.js frontend deployed with Monaco Editor
- [ ] Better Auth configured and working
- [ ] Kong Gateway configured with all routes
- [ ] Dapr components (state store, pub/sub) configured
- [ ] PostgreSQL database with schemas created
- [ ] Kafka topics created (learning-events, struggles)
- [ ] All services have health checks
- [ ] Documentation generated with Docusaurus
- [ ] End-to-end test passes (sign up â†’ code â†’ get help)
- [ ] AGENTS.md updated with actual structure
- [ ] All secrets stored in Kubernetes Secrets
- [ ] Resource limits configured
- [ ] Logs aggregated and accessible

---

## Hackathon Requirements

This application is being built for **Hackathon III: Reusable Intelligence and Cloud-Native Mastery**.

**Evaluation Criteria:**
- âœ… Built entirely by AI agents using skills
- âœ… Uses all required technologies (Neon, Kafka, Dapr, Kong, Better Auth)
- âœ… Demonstrates MCP Code Execution pattern
- âœ… Cross-agent compatible (Claude Code + Goose)
- âœ… One-prompt deployment capability
- âœ… Production-ready quality

**Submission URL**: https://forms.gle/Mrhf9XZsuXN4rWJf7

---

## Agent Collaboration

### For Claude Code:
- Skills are in `.claude/skills/` directory
- Use skills by name: "Use fastapi-dapr-agent to generate triage-service"
- All scripts execute with MCP Code Execution pattern (minimal context)

### For Goose:
- Same skills work identically
- Skills are in `.claude/skills/` directory
- Use skills by name with same syntax

### Working Together:
- Claude Code: Infrastructure setup, service generation
- Goose: Testing, validation, refinement
- Both: Can build complete application independently

---

**Repository Status**: ğŸ”¨ Under Construction
**Last Updated**: 2026-01-27
**Built With**: Claude Code + Skills from skills-library
**Hackathon**: Reusable Intelligence and Cloud-Native Mastery (III)
